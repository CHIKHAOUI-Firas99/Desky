
<style>
    th,td,input{
        text-align: center;
    }
    table{
        border-radius: 50px;
    }
  
</style>
<div class="xl:col-span-2 flex flex-col flex-auto bg-card  rounded-2xl overflow-hidden" >
   <strong> <h2  style="color: rgb(102, 125, 148); text-decoration:underline ;text-align: center; font-size: 30px; margin-top: 2%;" >
        Roles and Permissions</h2>
    </strong>
        <div class="card" style="margin-left: 15%;margin-right: 15%;margin-top: 5%; margin-top: 5%; height: 50%;" >
            <div>
                <!-- <h2 class="text-3xl font-semibold tracking-tight leading-8" style="color: rgb(64, 50, 50);margin-top: 1%; text-decoration:underline ;display: inline;" >
                    Manage roles</h2> -->
                  <div style="text-align: left;float:left ;display: inline;margin-top: 2%; margin-left: 1%;">
                    <input  matInput (keyup)="applyFilter($event)" placeholder="Search" #input matColumnDef="10">
                    <mat-icon >search</mat-icon>
                  </div>
                    <button class="btn btn-primary" style="float:right ;display: inline; margin-right: 1%;margin-top: 1%;" [disabled]="!canAdd" (click)="openDialog()" >New Role</button>
            </div>
            <form [formGroup]="VOForm"  >
            <br>
            <!-- <button  color="primary"  style="display: inline;"><mat-icon (click)="AddNewRow()" class="add-button">add_box</mat-icon></button> -->
           <ng-container formArrayName="VORows" >
                <table #table mat-table [dataSource]="roles" >
        
                  <!-- Position Column -->
                  <ng-container matColumnDef="Role_id">
                    <th mat-header-cell *matHeaderCellDef > Role_id </th>
                    <td mat-cell *matCellDef="let element; let i = index" [formGroup]="element">
                        <input matInput type="text" formControlName="id" [readonly]="true" #iduser >
                      </ng-container>                  
                  <!-- Name Column -->
                  <ng-container matColumnDef="name">
                    <th mat-header-cell *matHeaderCellDef > Name </th>
                    <td mat-cell *matCellDef="let element; let i = index" [formGroup]="element">
          
                      <!-- <span [hidden]="VOForm.get('VORows').value[i].isEditable"> -->
                      <mat-form-field   *ngIf="!VOForm.get('VORows').value[i].isEditable" style="width: 60%;"
                       >
                        <input matInput type="text" formControlName="name"  [readonly]="VOForm.get('VORows').value[i].isEditable" >
                     
                        </mat-form-field>
                      <button matInput type="text" style="border-radius: 25px;" 
                      [ngClass]="this.VOForm.get('VORows').value[i].name==='admin' ?'btn btn-danger':'btn btn-warning'" [readonly]="VOForm.get('VORows').value[i].isEditable" *ngIf="VOForm.get('VORows').value[i].isEditable">
                      <!-- </span> -->
                      {{VOForm.get('VORows').value[i].name}}
                     </button>
                    </td>
                  </ng-container>
          
                  <!-- claims Column -->
                  <ng-container matColumnDef="claims">
                    <th mat-header-cell *matHeaderCellDef > claims </th>
                    <td mat-cell *matCellDef="let element; let i = index" [formGroup]="element" >
                      <!-- [appearance]="true ? 'outline': 'fill'" -->
                      <!-- <span [hidden]="VOForm.get('VORows').value[i].isEditable"> -->
                      
        
                        <mat-form-field *ngIf="!VOForm.get('VORows').value[i].isEditable" style="width: 60%;" >
                          
                          <mat-select 
                            placeholder="claims"  multiple formControlName="claims"> 
                            <!-- Loop through each group via the groups array -->
                            <mat-optgroup   
          *ngFor="let group of allclaims" 
                            [label]="group.name">
                              <mat-option
                                *ngFor="let item of group.items"
                                [value]="item.value"
                                selected="true"
                              >
                                {{item.label}}
                              </mat-option>
                            </mat-optgroup>
                          </mat-select>
                        </mat-form-field>
                      
                      
                        <mat-form-field *ngIf="VOForm.get('VORows').value[i].isEditable" style="width: 60%;" >
                          
                          <mat-select 
                            placeholder="claims"  multiple formControlName="claims" > 
                            <!-- Loop through each group via the groups array -->
                            <ng-container *ngFor="let group of groups[i]" >
                              <mat-optgroup  [label]="group.name"  >
                                <strong *ngFor="let item of group.items">
                                  <mat-option *ngIf="item.test=='true'"
                                   [disabled]="true"
                                  [value]="item.value"
                                  
                                  selected="true"
                                >
                                  {{item.label}}
                                </mat-option>
            
                                </strong>  
                              </mat-optgroup>
                            </ng-container>
                            
                          </mat-select>
                        </mat-form-field>
                      <!-- <input matInput type="text" formControlName="claims" [readonly]="VOForm.get('VORows').value[i].isEditable"  *ngIf="VOForm.get('VORows').value[i].isEditable"> -->  
                            <!-- <mat-form-field appearance="outline" class="full-width" *ngIf="VOForm.get('VORows').value[i].isEditable">
                           
                                <mat-label>Claims</mat-label>
                                <mat-select [formControlName]="'claims'" [multiple]="true">
                                  <mat-option *ngFor="let claim of claims; let i = index" [value]="i">
                                    {{claim.name}}
                                  </mat-option>
                                </mat-select> 
                            </mat-form-field> -->
                        
                      <!-- </span> -->
                    </td>
                  </ng-container>
        
                  <ng-container matColumnDef="action">
                    <th mat-header-cell *matHeaderCellDef> Action </th>
                    <td mat-cell *matCellDef="let element; let i = index" [formGroup]="element">
                      <button mat-icon-button class="material-icons app-toolbar-menu save-button"
                                              matTooltip="Save Changes" (click)="SaveVO(VOForm, i, VOForm.get('VORows').value[i].id)"
                                              *ngIf="!VOForm.get('VORows').value[i].isEditable" >
                                              <mat-icon style="color: green;">check_circle</mat-icon>
                                          </button>
          
                      <button mat-icon-button class="material-icons app-toolbar-menu cancel-button"
                                              matTooltip="Cancel Changes" color="warn"
                                              (click)="CancelSVO(VOForm,i)"
                                              *ngIf="!VOForm.get('VORows').value[i].isEditable">
                                              <mat-icon>cancel</mat-icon>
                                          </button>
          
                      <button mat-icon-button class="material-icons app-toolbar-menu save-button"
                                              *ngIf="VOForm.get('VORows').value[i].isEditable"
                                              matTooltip="Edit" color="primary" (click)="EditSVO(VOForm,i)"
                                              [disabled]="!canEdit"
                                              >
                                              <mat-icon>edit</mat-icon>
                                          </button>
          
                      <button mat-icon-button class="material-icons app-toolbar-menu delete-button"
                      [disabled]="!canDelete"
                                              *ngIf="VOForm.get('VORows').value[i].isEditable"
                                              matTooltip="Delete" color="warn" (click)="delete(VOForm,i)">
                                              <mat-icon>delete</mat-icon>
                                          </button>
                    </td>
                  </ng-container>
          
                  <tr mat-header-row *matHeaderRowDef="displayedColumns" ></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          
                  <!-- Row shown when there is no matching data. -->
                  <!-- <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell" colspan="4">No data matching the filter "{{input.value}}"</td>
                  </tr> -->
                </table>
              </ng-container>
              <mat-card *ngIf="isLoading" style="display: flex; justify-content: center; align-items: center">
                <mat-progress-spinner 
                  color="primary" 
                  mode="indeterminate">
                </mat-progress-spinner>
              </mat-card>
              
          
                  <mat-paginator  [pageSizeOptions]="[2, roles.data.length>8? roles.data.length:''  ]" 
                    style="margin-top: 5%;" 
                   showFirstLastButtons (page)="onPageChange($event)"></mat-paginator>
                  
            </form>
          </div>
    </div>
   
  
